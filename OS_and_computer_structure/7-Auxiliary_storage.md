# 보조기억장치

## 7-1 다양한 보조기억장치

### 하드디스크

`하드디스크`는 자기적인 방식으로 데이터를 저장하는 보조기억장치이다. 이 때문에 하드 디스크를 `자기 디스크`의 일종으로 지칭하기도 한다.

하드디스크에서 실질적으로 데이터가 저장되는 곳은 원판인 `플래터`이다. 
그 플래터를 회전 시키는 역활을 하는 것을 `스핀들`이라고 한다. 
스핀들이 플래터를 돌리는 속도는 분당 회전수인 `RPM`으로 나타낸다.
플래터를 대상으로 데이터를 읽고 쓰는 부품을 `헤드`라고 한다.
헤드는 헤드를 원하는 위치로 이동시키는 `디스크 암`에 부착되어 있다. 일반적으로 플래터는 여러 겹으로 이루어져 있고 플래터 양면을 모두 사용할 수 있다. 일반적으로 모든 헤드는 디스크 암에 부착되어 다같이 이동한다.

플래터는 `트랙`과 `섹터`라는 단위로 데이터를 저장한다. 플래터를 동심원으로 나누었을 때 그중 하나의 원을 `트랙`이라고 부른다.
그리고 그 트랙은 마치 피자처럼 여러 조각으로 나눠져 있는데, 이 한 조각을 `섹터`라고 한다.
일반적으로 섹터는 512바이트 정도의 크기를 가지고 있지만, 정확한 크기는 하드 디스크에 따라 차이가 있다.

플래터는 여러 겁으로 이루어질 수 있는데 이때 여러 겹의 플래터 상에서 같은 트랙이 위치한 곳을 모아 연결한 논리적 단위를 `실린더`라고 부른다. 연속된 정보는 보통 한 실린더에 기록한다. 
예를 들어 두 개의 플래터를 사용하는 하드 디스크에서 네 개 섹터에 걸쳐 데이터를 저장할 때는 첫 번째 플래터 윗면, 첫 번째 플래터 뒷면, 두 번째 플래터 윗면, 두 번째 플래터 뒷면에 데이터를 저장한다.
연속된 정보를 하나의 실린더에 저장하는 이유는 디스크 암을 움직이지 않고도 바로 데이터에 접근할 수 있기 때문이다.

하드 디스크가 저장된 데이터에 접근하는 시간은 크게 `탐색 시간`, `회전 지연`, `전송 시간`으로 나뉜다.

#### 탐색 시간
접근하려는 데이터가 저장된 트랙까지 헤드를 이동시키는 시간을 의미한다.

#### 회전 지연
헤드가 있는 곳으로 플래터를 회전 시키는 시간을 의미한다.

#### 전송 시간
하드 디스크와 컴퓨터 간의 데이터를 전송하는 시간을 의미한다.

	프로그래머가 꼭 알아야 할 컴퓨터 시간들

| L1 캐시 참조 시간                                   | 0.5ns         |
| --------------------------------------------------- | ------------- |
| L1 캐시 참조 시간                                   | 0.5ns         |
| L2 캐시 참조 시간                                   | 5ns           |
| 메모리 참조 시간                                    | 7ns           |
| 메모리에서 1MB를 순차적으로 읽는 시간               | 250,000ns     |
| 하드 디스크 탐색 시간                               | 10,000,000ns  |
| 하드 디스크에서 1MB를 순차적으로 읽는 시간          | 30,000,000ns  |
| 한 패킷이 캘리포니아에서 네덜란드까지 왕복하는 시간 | 150,000,000ns |

2011년에 자료가 공개된 이후 오늘날 하드 디스크 성능은 많이 향상되었지만, 하드 디스크에서 다량의 데이터를 탐색하고 읽어 들이는 시간은 생각보다 어마어마하다.

탐색 시간과 회전 지연을 단축시키기 위해서 플래터를 빨리 돌려 RPM을 높이는 것도 중요하지만 `참조 지역성`을 활용해서 데이터가 플래터 혹은 헤드를 조금만 옮겨도 접근할 수 있는 위치해 있는 것도 중요하다.

	헤드가 트랙마다 있어서 탐색 시간이 들지 않는 `다중 헤드 디스크`도 존재한다. 이런 디스크를 `고정 헤드 디스크`라고 부르기도 한다.

### 플래시 메모리

USB 메모리, SD 카드, SSD가 모두 플래시 메모리 기반의 보조기억장치이다.
플래시 메모리는 전기적으로 데이터를 읽고 쓸 수 있는 `반도체 기반 저장 장치`이다. 
플래시 메모리는 보조기억장치 범주에만 속하지 않고 다양한 곳에 널리 사용하는 저장 장치다. 주기억장치 중 하나인 ROM에도 사용된다.

	플래시 메모리에는 크게 2가지 `NAND 플래시`와 `NOR 플래시 메모리`가 있다. 대용량 저장 장치로 많이 사용되는 플래시 메모리는 NAND 플래시로 특별한 언급이 없으면 '플래시 메모리'는 NAND 플래시를 의미한다.

플래시 메모리에는 `셀`이라는 단위가 있다.
셀이란 플래시 메모리에서 데이터를 저장하는 가장 작은 단위이다. 이때 하나의 셀에 몇 비트를 저장할 수 있느냐에 따라 플래시 메모리 종류가 나뉜다.
한 셀에 1비트를 저장할 수 있는 플래시 메모리를 `SLC`(`Single Level Cell`), 한 셀에 2비트를 저장할 수 있는 플래시 메모리를 `MLC`(`Multiple Level Cell`), 한 셀에 3비트를 저장할 수 있는 메모리를 `TLC`(`Triple-Level Cell`)이라고 한다.

#### SLC 타입
SLC 타입은 한 셀로 두 개의 정보를 표현할 수 있다. MLC나 TLC에 비해서 비트의 빠른 입출력이 가능하다. 
수명도 MLC나 TLC보다 길다. 하지만 용량 대비 가격이 비싸다.
보통 데이터를 읽고 쓰기가 매우 많이 발생하며, 고성능의 빠른 저장 장치가 필요한 경우 사용된다.

#### MLC 타입
SLC보다 일반적으로 속도와 수명은 떨어지지만, 한 셀에 두 비트씩 저장할 수 있다는 점에서 대용화하기 유리하다. 또한, SLC보다 용량 대비 가격이 저렴하다. 시중에서 사용되는 많은 플래시 메모리 저장 장치들이 MLC 또는 TLC로 만들어진다.

#### TLC 타입
한 셀에 3비트씩 저장할 수 있어 대용화 하기에 유리하다. 하지만 SLC이나 MLC보다 수명이나 속도가 떨어지며, 용량 대비 가격이 저렴하다.

| 구분           | SLC    | MLC  | TLC    |
| -------------- | ------ | ---- | ------ |
| 셀당 bit       | 1bit   | 2bit | 3bit   |
| 수명           | 길다   | 보통 | 짧다   |
| 읽기/쓰기 속도 | 빠르다 | 보통 | 느리다 |
| 용량 대비 가격 | 높다   | 보통 | 낮다   |

플래시 메모리의 셀보다 큰 단위에는 다음과 같은 것을이 있다.
셀들이 모여서 만들어진 단위인 `페이지`, 페이지가 모여 만들어진 단위인 `블록`, 블록이 모여서 만들어진 `플레인`, 플레인이 모여서 `다이`가 된다.

![플래시 메모리 단위](../img/플래시_메모리_단위.png)

플래시 메모리에서 읽기와 쓰기는 `페이지` 단위에서 이루어진다. 하지만 삭제는 페이지보다 큰 `블록` 단위로 이루어진다. 읽기/쓰기 단위와 삭제 단위가 다르다는 것이 플래시 메모리의 가장 큰 특징 중 하나이다.

페이지는 세 개의 상태를 가질 수 있다. 각각 `Free`, `Valid`, `Invalid` 상태이다.
* `Free` : 어떠한 데이터도 저장하고 있지 않아 새로운 데이터를 저장할 수 있는 상태
* `Valid` : 이미 유효한 데이터를 저장하고 있는 상태
* `Invalid` : 쓰레기값이라고 부르는 유효하지 않는 데이터를 저장하고 있는 상태

플래시 메모리는 하드 디스크와 달리 덮어쓰기가 불가능하여 Valid 상태인 페이지에는 새 데이터를 저장할 수 없다.

플래시 메모리는 삭제는 블록 단위로 이루어지고 값을 덮어쓸 수 없기 때문에 페이지에 쓰레기 값이 있는 경우, `가비지 컬렉션` 기능을 사용한다.
가비지 컬렉션은 유효한 페이지들만 새로운 블록으로 복사한 뒤, 기존의 블록을 삭제하는 기능이다.

## 7-2 RAID의 정의와 종류
